- config:
    name: 根据作品 ids 获取作品信息
    request:
        base_url: $platform_tiger_api_host
        url: /works/list
        method: POST
        headers:
            Content-Type: $content_type
    variables:
        - wrong_type_fields_element: ''
        - wrong_type_fields: '{}'
        - unsupport_fields_element: aaa

# - test:
#     name: work_ids只包含已发布ide作品-fields不传递
#     request:
#         json:
#             work_ids: [$source_user_ide_published_work_id]
#             fields: ["id"]
#     validate:
#         - eq: [status_code, 200]
#         - eq: [content.id, $source_user_ide_published_work_id]
#         - eq: [content.is_published, true]
#         - length_equals: [content, 9]
- test:
    name: work_ids只包含已发布ide作品-fields包含所有支持字段
    request:
        json:
            work_ids: [$source_user_ide_published_work_id]
            fields: ["id", "user_id", "name", "description", "type", "n_forks", "work_urls", "root_id", "parent_id", "preview", "latest_work_url", "view_times", "praise_times", "language_type", "operation_instruction", "publish_time"]
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 1]
        - eq: [content.0.id, $source_user_ide_published_work_id]
        - eq: [content.0.user_id, $source_user_id]
        - eq: [content.0.is_published, true]
        - eq: [content.0.type, 1]
        - eq: [content.0.language_type, 0]
        - eq: [content.0.is_published, true]
        - greater_than: [content.0.publish_time, 0]
        - length_equals: [content.0, 23]
        - contains: [content.0, description]
        - contains: [content.0, operation_instruction]
        - contains: [content.0, work_urls]
- test:
    name: work_ids只包含已发布ide作品-fields只包含id
    request:
        json:
            work_ids: [$source_user_ide_published_work_id]
            fields: ["id"]
    validate:
        - eq: [status_code, 200]
        - eq: [content.0.id, $source_user_ide_published_work_id]
        - eq: [content.0.is_published, true]
        - length_equals: [content.0, 9]
- test:
    name: work_ids只包含已发布ide作品-fields只包含id和user_id
    request:
        json:
            work_ids: [$source_user_ide_published_work_id]
            fields: ["id", "user_id"]
    validate:
        - eq: [status_code, 200]
        - eq: [content.0.id, $source_user_ide_published_work_id]
        - eq: [content.0.user_id, $source_user_id]
        - eq: [content.0.is_published, true]
        - length_equals: [content.0, 10]
- test:
    name: work_ids只包含已发布ide作品-fields为空数组
    request:
        json:
          work_ids: [$source_user_ide_published_work_id]
          fields: []
    validate:
        - eq: [status_code, 200]
        - eq: [content.0.id, $source_user_ide_published_work_id]
        - length_equals: [content.0, 9]
- test:
    name: work_ids只包含已发布ide作品-fields包含不支持字段
    request:
        json: 
            work_ids: [$source_user_ide_published_work_id]
            fields: ["id", $unsupport_fields_element]
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]
- test:
    name: work_ids只包含已发布ide作品-fields格式错误
    request:
        json:
            work_ids: [$source_user_ide_published_work_id]
            fields: $wrong_type_fields
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]
- test:
    name: work_ids只包含未发布ide作品-fields只包含user_id
    request:
        json:
            work_ids: [$source_user_ide_unpublish_work_id]
            fields: ["user_id"]
    validate:
        - eq: [status_code, 200]
        - eq: [content.0.id, $source_user_ide_unpublish_work_id]
        - eq: [content.0.is_published, false]
        - length_equals: [content.0, 10]
- test:
    name: work_ids包含临时删除和永久删除的ide作品-fields只包含user_id
    request:
        json:
            work_ids: [$source_user_ide_deleted_temporarily_work_id, $source_user_ide_deleted_permanently_work_id]
            fields: ["user_id"]
    validate:
        - eq: [status_code, 200]
        - eq: [content.0.is_published, false]
        - length_equals: [content.0, 10]
        - length_equals: [content, 2]
- test:
    name: work_ids不传递，fields只包含user_id
    request:
        json:
            fields: ["user_id"]
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 0]
- test:
    name: work_ids为空数组，fields只包含user_id
    request:
        json:
            work_ids: []
            fields: ["user_id"]
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]
- test:
    name: 请求体为空
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 0]