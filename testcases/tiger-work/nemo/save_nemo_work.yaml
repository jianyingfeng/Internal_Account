- config:
    name: 保存Nemo作品
    base_url: ${tiger_api_host()}
    variables:
        - test_create_nemo_work_name: 测试创建nemo作品
        - test_update_nemo_work_name: 测试修改nemo作品
        - nemo_n_blocks: 7
        - nemo_n_roles: 7
        - unexist_work_id: 100
        - wrong_type_work_id: aaa
        - nemo_bcm_version: '0.1.0'

- test:
    name: 创建Nemo作品(已登录)-name符合规则-work_id不传递
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: $test_create_nemo_work_name
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 200]
        - contains: [content, work_id] 
    extract:
        - nemo_work_id: content.work_id

- test:
    name: 验证：创建nemo作品后，作品type为8等
    setup_hooks:
        - ${sleep_N_secs(1)}
    api: api/platform-tiger-work/get_work_info.yaml
    variables:
        - work_id: $nemo_work_id
    validate:
        - eq: [status_code, 200]
        - eq: [content.user_id, '${source_user_id()}']
        - eq: [content.name, $test_create_nemo_work_name]
        - eq: [content.preview, '${source_user_nemo_preview_url()}']
        - eq: [content.type, 8]
        - eq: [content.status, 1]

- test:
    name: 创建Nemo作品(已登录)-name为空字符串
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: '111111111111111111111111111111111111111111111111112'
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 创建Nemo作品(已登录)-name长度超过50
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: ''
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 创建Nemo作品(已登录)-不传递name
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 创建Nemo作品(已登录)-不传递preview
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: $test_create_nemo_work_name
            work_url: ${source_user_nemo_work_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 创建Nemo作品(已登录)-不传递n_blocks
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: $test_create_nemo_work_name
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 创建Nemo作品(已登录)-不传递n_roles
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: $test_create_nemo_work_name
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 修改Nemo作品-wok_id为个人nemo作品
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: $test_update_nemo_work_name
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
            work_id: $nemo_work_id
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 1]
        - eq: [content.work_id, $nemo_work_id]

- test:
    name: 验证：修改nemo作品后，作品name等是否更新
    setup_hooks:
        - ${sleep_N_secs(1)}
    api: api/platform-tiger-work/get_work_info.yaml
    variables:
        - work_id: $nemo_work_id
    validate:
        - eq: [status_code, 200]
        - eq: [content.user_id, '${source_user_id()}']
        - eq: [content.name, $test_update_nemo_work_name]
        - eq: [content.preview, '${source_user_nemo_preview_url()}']
        - eq: [content.type, 8]
        - eq: [content.status, 1]

- test:
    name: 创建Nemo作品-未登录-所有参数正确
    request:
        method: POST
        url: /tiger/work/nemo
        json: 
            name: 测试创建nemo作品
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 403]
        - eq: [content.error_code, E_0]