- config:
    name: 保存和删除 nemo 作品
    base_url: ${tiger_api_host()}
    variables:
        - nemo_n_blocks: 7
        - nemo_n_roles: 7
        - unexist_work_id: 100
        - wrong_type_work_id: aaa
        - nemo_bcm_version: '0.1.0'


- test:
    name: 保存nemo作品(创建作品)-未登录-所有参数正确
    request:
        method: POST
        url: /tiger/work/nemo
        json: 
            name: 测试创建nemo作品
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 403]
        - eq: [content.error_code, E_0]

- test:
    name: 已登录-保存nemo作品(创建作品)
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: 测试创建nemo作品
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 200]
        - contains: [content, work_id] 
    extract:
        - nemo_work_id: content.work_id

- test:
    name: 已登录-保存nemo作品(修改作品)
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: 测试修改nemo作品
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
            work_id: $nemo_work_id
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 1]
        - eq: [content.work_id, $nemo_work_id]

- test:
    name: 已登录-保存nemo作品(创建作品)-不传递name
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 已登录-保存nemo作品(创建作品)-不传递preview
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: 测试创建nemo作品
            work_url: ${source_user_nemo_work_url()}
            n_blocks: $nemo_n_blocks
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 已登录-保存nemo作品(创建作品)-不传递n_blocks
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: 测试创建nemo作品
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_roles: $nemo_n_roles
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 已登录-保存nemo作品(创建作品)-不传递n_roles
    request:
        method: POST
        url: /tiger/work/nemo
        headers:
            Authorization: ${source_user_login_token()}
        json: 
            name: 测试创建nemo作品
            work_url: ${source_user_nemo_work_url()}
            preview: ${source_user_nemo_preview_url()}
            n_blocks: $nemo_n_blocks
            bcm_version: $nemo_bcm_version
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]


- test:
    name: 彻底删除Nemo作品-未登录-存在的nemo作品
    request:
        url: /tiger/work/nemo/$nemo_work_id
        method: DELETE
    validate:
        - eq: [status_code, 403]
        - eq: [content.error_code, E_0]
- test:
    name: 彻底删除Nemo作品-已登录-个人nemo作品
    request:
        url: /tiger/work/nemo/$nemo_work_id
        method: DELETE
        headers:
            Authorization: ${source_user_login_token()}
    validate:
        - eq: [status_code, 204]
- test:
    name: 彻底删除Nemo作品-已登录-他人作品
    request:
        url: /tiger/work/nemo/${target_user_nemo_work_id()}
        method: DELETE
        headers:
            Authorization: ${source_user_login_token()}
    validate:
        - eq: [status_code, 403]
        - eq: [content.error_code, W_3]
- test:
    name: 彻底删除Nemo作品-已登录-不存在的作品id
    request:
        url: /tiger/work/nemo/$unexist_work_id
        method: DELETE
        headers:
            Authorization: ${source_user_login_token()}
    validate:
        - eq: [status_code, 404]
        - eq: [content.error_code, W_0]
- test:
    name: 彻底删除Nemo作品-已登录-格式错误的作品
    request:
        url: /tiger/work/nemo/$wrong_type_work_id
        method: DELETE
        headers:
            Authorization: ${source_user_login_token()}
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]