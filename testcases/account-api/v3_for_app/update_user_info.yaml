- config:
    name: 修改用户信息
    base_url: ${tiger_api_host()}
    variables:
        - correct_nickname: test1234567
        - existed_nickname: 马晓倩123
        - nickname_length_21: '111111111122222222223'
        - correct_image_url: https://static-user-center.codemao.cn/user_0002.pn

- test:
    name: 未登录-传递nickname
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        json:
            nickname: test
    validate:
        - eq: [status_code, 403]
        - eq: [content.error_code, E_0]

# 修改nickname
- test:
    name: 已登录-nickname符合规则且未被使用
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            nickname: $correct_nickname
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-nickname已被使用
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            nickname: $existed_nickname
    validate:
        - eq: [status_code, 403]
        - eq: [content.error_code, AC3_25]

- test:
    name: 已登录-nickname长度超过20位
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            nickname: $nickname_length_21
    validate:
        - eq: [status_code, 400]

- test:
    name: 已登录-nickname为空字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            nickname: ''
    validate:
        - eq: [status_code, 400]

# 修改fullname
- test:
    name: 已登录-fullname为4位纯英文
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            fullname: 'aaaa'
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-fullname为2位纯英文
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            fullname: 'aa'
    validate:
        - eq: [status_code, 400]

- test:
    name: 已登录-fullname为30位纯英文
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            fullname: 'aaaaaaaaaabbbbbbbbbbcccccccccc'
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-fullname为31位纯英文
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            fullname: 'aaaaaaaaaabbbbbbbbbbccccccccccd'
    validate:
        - eq: [status_code, 400]

- test:
    name: 已登录-fullname为空字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            fullname: ''
    validate:
        - eq: [status_code, 204]

# 修改avatar_url
- test:
    name: 已登录-avatar_url为http地址
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            avatar_url: $correct_image_url
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-avatar_url非http地址
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            avatar_url: 'h'
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 已登录-avatar_url为空字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            avatar_url: ''
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

- test:
    name: 已登录-avatar_url超过255个字符
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            avatar_url: 'http://a.b.c/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaab'
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

# 修改sex
- test:
    name: 已登录-sex为0
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            sex: 0
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-sex为1
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            sex: 1
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-sex为2
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            sex: 2
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, A_5]

# 修改birthday
- test:
    name: 已登录-birthday为0
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            birthday: 0
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-birthday为负数
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            birthday: -200
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-birthday超过int类型最小负数
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            birthday: -2147483649
    validate:
        - eq: [status_code, 400]

# 修改qq信息
- test:
    name: 已登录-qq为空字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            qq: ''
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-qq为1位数字字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            qq: '1'
    validate:
        - eq: [status_code, 400]

- test:
    name: 已登录-qq为5位数字字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            qq: '12345'
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-qq为20位数字字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            qq: '11111111112222222222'
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-qq为21位数字字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            qq: '111111111122222222223'
    validate:
        - eq: [status_code, 400]

- test:
    name: 已登录-qq为5位非纯数字字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            qq: 'a1234'
    validate:
        - eq: [status_code, 400]

# 修改description
- test:
    name: 已登录-description格式正确
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            description: 'a1234'
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-description为空字符串
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            description: ''
    validate:
        - eq: [status_code, 204]

- test:
    name: 已登录-description超过255位字符
    request:
        method: PATCH
        url: /tiger/v3/app/accounts/info
        headers:
            Authorization: ${source_user_login_token()}
        json:
            description: 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaab'
    validate:
        - eq: [status_code, 400]