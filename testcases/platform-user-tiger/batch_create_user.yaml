- config:
    name: 批量创建用户
    request:
        base_url: ${platform_tiger_api_host()}
        method: POST
        url: /accounts/batch
        headers:
            Content-Type: ${content_type()}
    variables:
        - pc_pid: UvOFXx2tfv
        - password: m1234567
        - test_prefix: testbach

- test:
    name: prefix格式正确-password格式正确(创建2个账号)
    request:
        json:
            prefix: $test_prefix
            users: [{"password": $password}, {"password": $password}]
            pid: $pc_pid
    extract:
        - user1_id: content.0.id
        - user1_username: content.0.username
        - user2_id: content.1.id
        - user2_username: content.1.username
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 2]
        - length_equals: [content.0, 3]
        - contains: [content.0, id]
        - contains: [content.0, username]
        # 确保返回的user_id,username是升序排列
        - less_than: [$user1_id, $user2_id]
        - less_than: [$user1_username, $user2_username]
        
- test:
    name: 批量创建的用户1应可以正常登录
    api: api/account/account_login.yaml
    variables:
        identity: $user1_username
        password: $password
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 4]
        - contains: [content, token]
- test:
    name: 批量创建的用户2应可以正常登录
    api: api/account/account_login.yaml
    variables:
        identity: $user2_username
        password: $password
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 4]
        - contains: [content, token]