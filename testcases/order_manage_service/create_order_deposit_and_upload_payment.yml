- config:
    name: 接口组合测试：创建订金订单-上传支付凭证-业务审核通过-财务审核通过
    base_url: ${ENV(order_service_host)}
    variables:
        - deposit_order_price: 0.01

- test:
    skipIf: ${is_production()}
    name: 创建订金订单成功
    api: api/order_manage_service/create_order_deposit.yml
    variables:
        - placedById: ${internal_source_user_id()}
        - customerId: ${source_user_id()}
        - skuNumber: ${sku_number_deposit()}
        - deposit: $deposit_order_price
    validate:
        - eq: [status_code, 200]
    extract:
        - deposit_order_id: content.orderId

- test:
    skipIf: ${is_production()}
    name: 创建订金订单后上传支付凭证-orderPlatform为TMALL
    api: api/order_manage_service/upload_payment.yml
    variables:
        - order_id: $deposit_order_id
        - handledById: ${internal_source_user_id()}
        - transactionNumber: ${random_transaction_number()}
        - orderPlatform: TMALL
        - actualPayment: $deposit_order_price
    validate:
        - eq: [status_code, 200]

- test:
    skipIf: ${is_production()}
    name: 获取付款审核单ID(paymentReviewId)
    api: api/order_manage_service/get_payments_reviews_list.yml
    variables:
        - orderIds: $deposit_order_id
    validate:
        - eq: [status_code, 200]
    extract:
        - paymentReviewId: content.items.0.paymentReviewId

- test:
    skipIf: ${is_production()}
    name: 业务审核转账审核单：审核通过
    api: api/order_manage_service/bm_review_payment_reviews.yml
    variables:
        - orderId: $deposit_order_id
        - paymentReviewId: $paymentReviewId
        - reviewPassed: true
        - reviewedById: ${internal_source_user_id()}

- test:
    skipIf: ${is_production()}
    name: 财务审核转账审核单：审核通过
    api: api/order_manage_service/fm_review_payment_reviews.yml
    variables:
        - orderId: $deposit_order_id
        - paymentReviewId: $paymentReviewId
        - reviewPassed: true
        - reviewedById: ${internal_source_user_id()}
        - receivedAt: ${get_timestamp(10)}